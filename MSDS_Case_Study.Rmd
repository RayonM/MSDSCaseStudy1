---
title: "MSDS CaseStudy-1"
author: "Rayon M"
date: "6/11/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Introduction

Good day Mr. CEO & CFO. I'd like to thank you for accepting my invitation. Today, I'd like to address the questions you recently posed during our last Steering Committee meeting and provide you with a brief analysis that may peak your interest. This research was done using the Beer and Breweries data provided. 


```{r}

# Install all needed R libraries and packages.

library(tidyverse)
library(ggthemes)
library(ggplot2)
library(plotly)
library(GGally)
library(caret)
library(maps)
library(dplyr)
library(mapproj)

```

#Cookbook

```{r}

# #Load beers data
beers = read.csv(file.choose())
# 
# #Load breweries data
breweries = read.csv(file.choose())

#Quick look at the dataframe for both datasets.
head(beers)
head(breweries)


```

# How many breweries are present in each state?

```{r, echo=FALSE}

#Use the breweries dataset to calculate the number of breweries present in each State.
#This data will be stored in the variable "totals."
breweries_Count_State = count(breweries, State)


#Rename the column n to a recognizable name.
colnames(breweries_Count_State)[2] ="Count"

#Here I'm using the totals variable to display the number of breweries per State.
breweries_Count_State %>% ggplot(mapping = aes(x = State, y = Count)) +
  geom_bar(stat = "identity", color = "black", fill = "red" )+
  xlab("States")  + ylab("Count of Breweries")+
  geom_text(aes(State, Count+1, label = Count), data = breweries_Count_State, col="blue")+
  ggtitle("Breweries per State")+
  theme_wsj()
?geom_text

#Would be cool to do this using the US Map
colnames(breweries)[4] = "abb"
breweries$abb = trimws(breweries$abb)
breweries
lookup = data.frame(abb = state.abb, State = state.name)
lookup
new_breweries = merge(breweries,lookup, by = "abb", all = TRUE)
new_breweries
totals = count(new_breweries, State)
na.omit(new_breweries)
totals$region <- tolower(totals$State)
totals
colnames(totals)[2] = "count"
totals2 = totals[-1]
totals2
states <- map_data("state")
states
states2 = states[-6]
states2
map.df <- merge(states2,totals2, by ="region", all.x = TRUE)
map.df
map.df <- map.df[order(map.df$order),]

#Functioning Code but it's not correct
heatMap = ggplot(map.df, aes(x=long,y=lat, group = group))+
  geom_polygon(aes(fill= count))+
  geom_text(aes(x=long, y=lat, label = map.df$count), col="black", cex=3)+
  scale_fill_gradientn(colours=rev(heat.colors(5)),na.value="black")+
  ggtitle("Breweries per State")+
  coord_map()+
  geom_path()+
  xlab("Longitute") + ylab("Latitude")+
  theme_wsj()
ggplotly(heatMap)

```


# MergeMerge beer data with the breweries data. Print the first 6 observations and the last six observations to check the merged file.  (RMD only, this does not need to be included in the presentation or the deck.)

```{r}
#Note: Reload the data to prevent issues due to above manipulation for HeatMap

beers_Breweries = merge(beers, breweries, by.x = "Brewery_id", by.y = "Brew_ID")

head(beers_Breweries)
tail(beers_Breweries)

#Rename the columns Name.x and Name.y to be more meaningful names.
colnames(beers_Breweries)[2] = "Beer_Name"
colnames(beers_Breweries)[8] = "Brewery_Name"

#Remove all 
beersNbreweries = na.omit(beers_Breweries)
Sums = count(beersNbreweries, State)
colnames(Sums)[2] = "Count"

beersNbreweries %>% ggplot(mapping = aes(x = State)) +
  geom_bar(color = "black", fill = "brown" )+
  xlab("States")  + ylab("Number of Breweries")+
  geom_text(aes(State, Count+3, label = Count), data = Sums)+
  ggtitle("Breweries per State")+
  theme_fivethirtyeight()

```

# Compute the median alcohol content and international bitterness unit for each state. Plot a bar chart to compare.

```{r}

ABV_State_Median_Plot = beersNbreweries %>% group_by(State) %>% summarize(ABV_State_median = median(ABV)) %>%
  ggplot(mapping = aes(y = ABV_State_median, x = State, stroke = 3))+
  geom_point(color = "brown", fill = "black")+
  theme_excel()+
  ggtitle("Mean Alcohol Content per State") + xlab("STATES") + ylab ("ABV Mean")
  ggplotly(ABV_State_Median_Plot)

##g1 = beersNbreweries %>% group_by(State) %>% summarize(ABV_State_median = median(ABV)) # Throw away code
##write.csv(g1, "ABV_mean.csv") # Throw away code

##g2 = beersNbreweries %>% group_by(State) %>% summarize(IBU_State_median = median(IBU)) # Throw away code
##write.csv(g2, "IBU_mean.csv") # Throw away code

IBU_State_Median_Plot = beersNbreweries %>% group_by(State) %>% summarize(IBU_State_median = median(IBU)) %>%
  ggplot(mapping = aes(y = IBU_State_median, x = State, stroke = 3))+
  geom_point(color = "brown", fill = "black")+
  theme_excel()+
  ggtitle("Mean Internation Bitterness Unit per State") + xlab("STATES") + ylab ("IBU Mean")
  ggplotly(IBU_State_Median_Plot)

```
# Which state has the maximum alcoholic (ABV) beer? Which state has the most bitter (IBU) beer?

```{r}

beersNbreweries %>% summarize(Max_ABV = max(ABV)) %>% arrange(Max_ABV, by_group = TRUE)

beersNbreweries %>% summarize(Max_IBU = max(IBU)) %>% arrange(Max_IBU, by_group = TRUE)

?which
```

# Comment on the summary statistics and distribution of the ABV variable.

```{r}

beersNbreweries %>% ggplot(mapping = aes(x = ABV))+
geom_histogram()

beersNbreweries %>% ggplot(mapping = aes(x = ABV))+
geom_boxplot()

summary(beersNbreweries$ABV)

```

# Is there an apparent relationship between the bitterness of the beer and its alcoholic content? Draw a scatter plot.  Make your best judgment of a relationship and EXPLAIN your answer

```{r}

beersNbreweries %>% ggplot(mapping = aes(x = ABV, y = IBU, ABV ="jitter", color = State)) +
  geom_point()


beersNbreweries %>% select(ABV, IBU) %>% ggpairs(aes())

  


```

#Budweiser would also like to investigate the difference with respect to IBU and ABV between IPAs (India Pale Ales) and other types of Ale (any beer with “Ale” in its name other than IPA).  You decide to use KNN classification to investigate this relationship.  Provide statistical evidence one way or the other. You can of course assume your audience is comfortable with percentages … KNN is very easy to understand conceptually.


```{r}
#Due June 26th


(grep("SUSHI", df_Baltimore_Restaurants$name))
length(grep("SUSHI", df_Baltimore_Restaurants$name))
sum(grepl("SUSHI", df_Baltimore_Restaurants$name))
which(grepl("SUSHI", df_Baltimore_Restaurants$name))

```

